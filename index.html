<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Bcred Consultoria</title>
 
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
    import {
      getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

    // Substitua com SUAS credenciais!
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    window.db = db;
    window.auth = auth;
    window.getDocs = getDocs;
    window.addDoc = addDoc;
  </script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f2f5; }
    header { background: #0073e6; color: white; padding: 40px; text-align: center; }
    .login-section, .admin-login-section {
      background: white; max-width: 400px; margin: -30px auto 0; padding: 30px;
      border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; }
    button { background: #0073e6; color: white; padding: 12px; border: none; border-radius: 5px; width: 100%; cursor: pointer; }
    .dashboard, .admin-dashboard {
      display: none; background: white; max-width: 800px; margin: 30px auto; padding: 30px;
      border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background: #f8f9fa; }
    .logout-button { background: #dc3545; margin-top: 20px; }
  </style>
</head>
<body>
  <header>
    <h1>Painel Administrativo Bcred</h1>
    <p>Soluções financeiras inteligentes</p>
  </header>

  <!-- Login Cliente -->
  <div class="login-section" id="loginSection">
    <h2>Acesso do Cliente</h2>
    <input type="text" id="username" placeholder="Digite seu CPF (apenas números)" maxlength="11">
    <input type="password" id="password" placeholder="Senha">
    <button onclick="loginCliente()">Acessar</button>
    <p style="margin-top:15px; text-align:center">
      <a href="#" onclick="showAdminLogin()" style="color:#0073e6">Acesso Administrativo</a>
    </p>
  </div>

  <!-- Painel Cliente -->
  <div class="dashboard" id="dashboard">
    <h2>Seu Empréstimo</h2>
    <p><strong>Nome:</strong> <span id="clientName">-</span></p>
    <p><strong>Valor contratado:</strong> <span id="loanAmount">-</span></p>
    <p><strong>Parcelas:</strong> <span id="installments">-</span></p>
    <p><strong>Valor da parcela:</strong> <span id="monthlyPayment">-</span></p>
    <p><strong>Status:</strong> <span id="loanStatus" style="color:#28a745">-</span></p>
    <button class="logout-button" onclick="logoutCliente()">Sair</button>
  </div>

  <!-- Login Admin -->
  <div class="admin-login-section" id="adminLoginSection" style="display:none">
    <h2>Acesso Administrativo</h2>
    <input type="email" id="adminEmail" placeholder="E-mail administrativo">
    <input type="password" id="adminPassword" placeholder="Senha">
    <button onclick="loginAdmin()">Acessar</button>
    <p style="margin-top:15px; text-align:center">
      <a href="#" onclick="showClientLogin()" style="color:#0073e6">Voltar ao cliente</a>
    </p>
  </div>

  <!-- Painel Admin -->
  <div class="admin-dashboard" id="adminDashboard">
    <h2>Gestão de Clientes</h2>
   
    <div style="background:#f8f9fa; padding:20px; border-radius:8px; margin-bottom:30px">
      <h3>Novo Cadastro</h3>
      <input type="text" id="newCpf" placeholder="CPF (apenas números)" maxlength="11">
      <input type="text" id="newName" placeholder="Nome completo">
      <input type="number" id="newLoanAmount" placeholder="Valor do empréstimo (R$)">
      <input type="number" id="newInstallments" placeholder="Número de parcelas">
      <input type="password" id="newPassword" placeholder="Senha do cliente">
      <select id="newStatus">
        <option value="Aprovado">Aprovado</option>
        <option value="Em Análise">Em análise</option>
        <option value="Reprovado">Reprovado</option>
      </select>
      <button onclick="addCliente()" style="margin-top:10px">Cadastrar Cliente</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>CPF</th>
          <th>Nome</th>
          <th>Valor</th>
          <th>Parcelas</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="clientList"></tbody>
    </table>
    <button class="logout-button" onclick="logoutAdmin()">Sair</button>
  </div>

  <!-- Script Principal -->
  <script>
    // Funções essenciais
    function formatarMoeda(valor) {
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
    }

    function calcularParcela(valor, parcelas) {
      const taxaJuros = 1.35 / 100;
      const parcela = (valor * taxaJuros) / (1 - Math.pow(1 + taxaJuros, -parcelas));
      return parseFloat(parcela.toFixed(2));
    }

    // Controle de login
    async function loginCliente() {
      const cpf = document.getElementById('username').value.replace(/\D/g, '');
      const senha = document.getElementById('password').value;

      const querySnapshot = await getDocs(query(
        collection(db, 'clientes'),
        where('cpf', '==', cpf),
        where('senha', '==', senha)
      ));

      if (!querySnapshot.empty) {
        const cliente = querySnapshot.docs[0].data();
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        document.getElementById('clientName').textContent = cliente.nome;
        document.getElementById('loanAmount').textContent = formatarMoeda(cliente.valor);
        document.getElementById('installments').textContent = `${cliente.parcelas}x`;
        document.getElementById('monthlyPayment').textContent = formatarMoeda(cliente.valorParcela);
        document.getElementById('loanStatus').textContent = cliente.status;
      } else {
        alert('Credenciais inválidas!');
      }
    }

    async function addCliente() {
      const novoCliente = {
        cpf: document.getElementById('newCpf').value.replace(/\D/g, ''),
        nome: document.getElementById('newName').value.trim(),
        valor: parseFloat(document.getElementById('newLoanAmount').value),
        parcelas: parseInt(document.getElementById('newInstallments').value),
        senha: document.getElementById('newPassword').value.trim(),
        status: document.getElementById('newStatus').value,
        valorParcela: calcularParcela(
          parseFloat(document.getElementById('newLoanAmount').value),
          parseInt(document.getElementById('newInstallments').value)
        )
      };

      // Verificar CPF único
      const cpfExistente = await getDocs(query(
        collection(db, 'clientes'),
        where('cpf', '==', novoCliente.cpf)
      ));
     
      if (!cpfExistente.empty) return alert('CPF já cadastrado!');

      try {
        await addDoc(collection(db, 'clientes'), novoCliente);
        alert('Cliente cadastrado!');
        carregarClientes();
      } catch (error) {
        alert(`Erro: ${error.message}`);
      }
    }

    // Funções auxiliares
    function showAdminLogin() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('adminLoginSection').style.display = 'block';
    }

    function logoutCliente() {
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('loginSection').style.display = 'block';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    }

    // ... (outras funções do admin)
  </script>
</body>
</html>
